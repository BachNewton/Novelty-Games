{"version":3,"file":"primeWorker-DUSiMuMg.js","sources":["../src/tools/prime-finder/workers/primeWorker.ts"],"sourcesContent":["import { CoordinatorMessage, WorkerMessage, BatchResultMessage, ProgressMessage } from '../data/MessageTypes';\r\n\r\n/* eslint-disable no-restricted-globals */\r\nconst ctx: Worker = self as unknown as Worker;\r\n\r\nlet workerId = -1;\r\n\r\nfunction isPrime(n: number, knownPrimes: number[]): boolean {\r\n    if (n < 2) return false;\r\n    if (n === 2) return true;\r\n    if (n % 2 === 0) return false;\r\n\r\n    const sqrtN = Math.sqrt(n);\r\n\r\n    // First check against known primes\r\n    for (const prime of knownPrimes) {\r\n        if (prime > sqrtN) break;\r\n        if (n % prime === 0) return false;\r\n    }\r\n\r\n    // If knownPrimes doesn't cover sqrt(n), continue with odd numbers\r\n    const lastKnown = knownPrimes.length > 0 ? knownPrimes[knownPrimes.length - 1] : 2;\r\n    if (lastKnown < sqrtN) {\r\n        let start = lastKnown + (lastKnown % 2 === 0 ? 1 : 2);\r\n        for (let i = start; i <= sqrtN; i += 2) {\r\n            if (n % i === 0) return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction processBatch(batchStart: number, batchSize: number, knownPrimes: number[]): void {\r\n    const startTime = performance.now();\r\n    const foundPrimes: number[] = [];\r\n    const batchEnd = batchStart + batchSize - 1;\r\n\r\n    const progressInterval = Math.max(1000, Math.floor(batchSize / 10));\r\n\r\n    for (let n = batchStart; n <= batchEnd; n++) {\r\n        if (isPrime(n, knownPrimes)) {\r\n            foundPrimes.push(n);\r\n        }\r\n\r\n        // Send progress updates periodically\r\n        if ((n - batchStart) % progressInterval === 0 && n !== batchStart) {\r\n            const progressMsg: ProgressMessage = {\r\n                type: 'PROGRESS',\r\n                workerId,\r\n                currentNumber: n,\r\n                primesFoundInBatch: foundPrimes.length\r\n            };\r\n            ctx.postMessage(progressMsg);\r\n        }\r\n    }\r\n\r\n    const computeTimeMs = performance.now() - startTime;\r\n\r\n    const resultMsg: BatchResultMessage = {\r\n        type: 'BATCH_RESULT',\r\n        workerId,\r\n        foundPrimes,\r\n        numbersChecked: batchSize,\r\n        batchStart,\r\n        batchEnd,\r\n        computeTimeMs\r\n    };\r\n\r\n    ctx.postMessage(resultMsg);\r\n}\r\n\r\nctx.onmessage = (event: MessageEvent<CoordinatorMessage>) => {\r\n    const message = event.data;\r\n\r\n    switch (message.type) {\r\n        case 'INIT':\r\n            workerId = message.workerId;\r\n            const readyMsg: WorkerMessage = {\r\n                type: 'READY',\r\n                workerId\r\n            };\r\n            ctx.postMessage(readyMsg);\r\n            break;\r\n\r\n        case 'WORK_BATCH':\r\n            processBatch(message.batchStart, message.batchSize, message.knownPrimes);\r\n            break;\r\n\r\n        case 'STOP':\r\n            close();\r\n            break;\r\n    }\r\n};\r\n"],"names":["ctx","workerId","isPrime","n","knownPrimes","sqrtN","prime","lastKnown","start","i","processBatch","batchStart","batchSize","startTime","foundPrimes","batchEnd","progressInterval","progressMsg","computeTimeMs","resultMsg","event","message","readyMsg"],"mappings":"yBAGA,MAAMA,EAAc,KAEpB,IAAIC,EAAW,GAEf,SAASC,EAAQC,EAAWC,EAAgC,CACxD,GAAID,EAAI,EAAG,MAAO,GAClB,GAAIA,IAAM,EAAG,MAAO,GACpB,GAAIA,EAAI,IAAM,EAAG,MAAO,GAExB,MAAME,EAAQ,KAAK,KAAKF,CAAC,EAGzB,UAAWG,KAASF,EAAa,CAC7B,GAAIE,EAAQD,EAAO,MACnB,GAAIF,EAAIG,IAAU,EAAG,MAAO,EAChC,CAGA,MAAMC,EAAYH,EAAY,OAAS,EAAIA,EAAYA,EAAY,OAAS,CAAC,EAAI,EACjF,GAAIG,EAAYF,EAAO,CACnB,IAAIG,EAAQD,GAAaA,EAAY,IAAM,EAAI,EAAI,GACnD,QAASE,EAAID,EAAOC,GAAKJ,EAAOI,GAAK,EACjC,GAAIN,EAAIM,IAAM,EAAG,MAAO,EAEhC,CAEA,MAAO,EACX,CAEA,SAASC,EAAaC,EAAoBC,EAAmBR,EAA6B,CACtF,MAAMS,EAAY,YAAY,IAAA,EACxBC,EAAwB,CAAA,EACxBC,EAAWJ,EAAaC,EAAY,EAEpCI,EAAmB,KAAK,IAAI,IAAM,KAAK,MAAMJ,EAAY,EAAE,CAAC,EAElE,QAAST,EAAIQ,EAAYR,GAAKY,EAAUZ,IAMpC,GALID,EAAQC,EAAGC,CAAW,GACtBU,EAAY,KAAKX,CAAC,GAIjBA,EAAIQ,GAAcK,IAAqB,GAAKb,IAAMQ,EAAY,CAC/D,MAAMM,EAA+B,CACjC,KAAM,WACN,SAAAhB,EACA,cAAeE,EACf,mBAAoBW,EAAY,MAAA,EAEpCd,EAAI,YAAYiB,CAAW,CAC/B,CAGJ,MAAMC,EAAgB,YAAY,IAAA,EAAQL,EAEpCM,EAAgC,CAClC,KAAM,eACN,SAAAlB,EACA,YAAAa,EACA,eAAgBF,EAChB,WAAAD,EACA,SAAAI,EACA,cAAAG,CAAA,EAGJlB,EAAI,YAAYmB,CAAS,CAC7B,CAEAnB,EAAI,UAAaoB,GAA4C,CACzD,MAAMC,EAAUD,EAAM,KAEtB,OAAQC,EAAQ,KAAA,CACZ,IAAK,OACDpB,EAAWoB,EAAQ,SACnB,MAAMC,EAA0B,CAC5B,KAAM,QACN,SAAArB,CAAA,EAEJD,EAAI,YAAYsB,CAAQ,EACxB,MAEJ,IAAK,aACDZ,EAAaW,EAAQ,WAAYA,EAAQ,UAAWA,EAAQ,WAAW,EACvE,MAEJ,IAAK,OACD,MAAA,EACA,KAAA,CAEZ"}