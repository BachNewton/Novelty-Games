(function(){"use strict";function v(o){let r=o>>>0;function n(){r|=0,r=r+1831565813|0;let c=Math.imul(r^r>>>15,1|r);return c=c+Math.imul(c^c>>>7,61|c)^c,((c^c>>>14)>>>0)/4294967296}return{next:n,nextInt:c=>Math.floor(n()*c),nextRange:(c,h)=>c+n()*(h-c),nextBool:(c=.5)=>n()<c,shuffle:c=>{const h=[...c];for(let p=h.length-1;p>0;p--){const l=Math.floor(n()*(p+1));[h[p],h[l]]=[h[l],h[p]]}return h},pick:c=>c[Math.floor(n()*c.length)]}}function X(o,r,n){let c=n;return c=Math.imul(c^(o|0),2246822507),c=Math.imul(c^(r|0),3266489909),c^=c>>>16,c>>>0}const A=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]],tt=.5*(Math.sqrt(3)-1),Y=(3-Math.sqrt(3))/6;function T(o){const r=v(o),n=[],c=[];for(let t=0;t<256;t++)n[t]=t;for(let t=255;t>0;t--){const s=r.nextInt(t+1);[n[t],n[s]]=[n[s],n[t]]}for(let t=0;t<512;t++)n[t]=n[t&255],c[t]=n[t]&7;function h(t,s,e,a){return t*e+s*a}function p(t,s){const e=(t+s)*tt,a=Math.floor(t+e),d=Math.floor(s+e),u=(a+d)*Y,S=a-u,f=d-u,g=t-S,m=s-f;let y,x;g>m?(y=1,x=0):(y=0,x=1);const M=g-y+Y,N=m-x+Y,E=g-1+2*Y,C=m-1+2*Y,b=a&255,H=d&255;let I=0,_=0,w=0,Z=.5-g*g-m*m;if(Z>=0){Z*=Z;const U=c[b+n[H]],[R,D]=A[U];I=Z*Z*h(R,D,g,m)}let K=.5-M*M-N*N;if(K>=0){K*=K;const U=c[b+y+n[H+x]],[R,D]=A[U];_=K*K*h(R,D,M,N)}let k=.5-E*E-C*C;if(k>=0){k*=k;const U=c[b+1+n[H+1]],[R,D]=A[U];w=k*k*h(R,D,E,C)}return 70*(I+_+w)}function l(t,s,e,a,d){let u=0,S=1,f=1,g=0;for(let m=0;m<e;m++)u+=p(t*f,s*f)*S,g+=S,S*=a,f*=d;return u/g}function i(t,s,e,a,d){let u=0,S=1,f=1,g=0;for(let m=0;m<e;m++){const y=1-Math.abs(p(t*f,s*f));u+=y*y*S,g+=S,S*=a,f*=d}return u/g}return{noise2D:p,octaveNoise2D:l,ridgedNoise2D:i}}const W=.002,L=.015,B=.08,q=.01,G=.005;function et(o){const r=T(o),n=T(o+1e3),c=T(o+2e3),h=T(o+3e3),p=T(o+4e3);function l(i,t,s){const e=Math.max(0,Math.min(1,(s-i)/(t-i)));return e*e*(3-2*e)}return{getElevation:(i,t)=>{const s=r.octaveNoise2D(i*W,t*W,4,.5,2),e=n.ridgedNoise2D(i*L,t*L,4,.5,2),a=c.octaveNoise2D(i*B,t*B,3,.5,2)*.15,d=l(-.1,.2,s),u=s*.4,S=e*.5*d;return u+S+a},getMoisture:(i,t)=>h.octaveNoise2D(i*q,t*q,4,.5,2)*.5+.5,getTemperature:(i,t)=>{const s=Math.cos(t*.003)*.4+.5,e=p.octaveNoise2D(i*G,t*G,3,.5,2)*.2;return Math.max(0,Math.min(1,s+e))}}}function nt(o,r,n){return o<-.3?0:o<-.15?1:o<-.05?2:o<.02?3:o>.55?10:o>.4?9:o>.25?8:n<.25?11:r<.25?7:r<.4?n>.6?7:4:r>.7?n>.65?6:n<.35?12:5:r>.5?n>.6?6:5:4}function ot(o){return o===4||o===5||o===8||o===3}const P={0:{prefixes:["Thor","Frost","Iron","Storm","Wolf","Raven","Snow","Ice","Stone","Bear"],roots:["heim","gard","fjord","vik","dal","berg","holm","vang","fell","mark"],suffixes:["en","","stad","by","ness"]},1:{prefixes:["Dun","Glen","Bally","Kin","Strath","Aber","Kil","Loch","Ben","Cairn"],roots:["more","derry","bridge","ford","wick","ton","wood","field","vale","moor"],suffixes:["","ey","ie","ach","an"]},2:{prefixes:["Port","Villa","Monte","Bella","Alta","Nova","Santa","San","Rio","Terra"],roots:["vista","mare","rosa","verde","luna","sol","oro","plata","cruz","piedra"],suffixes:["","ia","um","ino","ero"]},3:{prefixes:["Al","El","Kas","Dar","Bab","Wadi","Oum","Ain","Jebel","Ras"],roots:["rashid","salem","qadir","malik","hamid","kareem","zahir","nadir","farid","jamil"],suffixes:["","a","i","abad","stan"]},4:{prefixes:["Jade","Golden","Silver","Dragon","Phoenix","Moon","Sun","Cloud","Misty","Crane"],roots:["peak","river","gate","bridge","garden","temple","spring","lake","forest","mountain"],suffixes:[""," Valley"," Heights"," Crossing",""]},5:{prefixes:["Shadow","Crystal","Silver","Ember","Thorn","Mist","Star","Dawn","Dusk","Rune"],roots:["mere","vale","spire","haven","hold","gate","wood","glade","keep","reach"],suffixes:["","shire","land","fell","dale"]}},st={0:["Abyss","Depths","Deep"],1:["Sea","Waters","Ocean"],2:["Bay","Gulf","Strait"],3:["Shore","Coast","Strand"],4:["Plains","Grasslands","Steppes","Prairie"],5:["Forest","Woods","Woodland","Grove"],6:["Jungle","Rainforest","Wilds"],7:["Desert","Wastes","Sands","Dunes"],8:["Hills","Highlands","Downs"],9:["Mountains","Peaks","Range","Heights"],10:["Frostpeaks","Snowcaps","Icepeaks"],11:["Tundra","Wastes","Barrens","Expanse"],12:["Swamp","Marsh","Bog","Mire"],13:["Lake","Loch","Mere"],14:["River","Stream","Waters"]};function it(o){return{generateCityName:(r,n,c)=>{const h=X(Math.floor(n),Math.floor(c),o+7919),p=v(h),l=P[r],i=p.next()<.7,t=p.next()<.5;let s="";return i&&(s+=p.pick(l.prefixes)),s+=p.pick(l.roots),t&&(s+=p.pick(l.suffixes)),s.charAt(0).toUpperCase()+s.slice(1)},generateRegionName:(r,n,c,h)=>{const p=X(Math.floor(c),Math.floor(h),o+8923),l=v(p),i=P[r],t=st[n]||["Lands"],s=[()=>`The ${l.pick(i.prefixes)} ${l.pick(t)}`,()=>`${l.pick(i.prefixes)}${l.pick(i.roots)} ${l.pick(t)}`,()=>`${l.pick(t)} of ${l.pick(i.prefixes)}${l.pick(i.roots)}`];return l.pick(s)()}}}function O(o,r,n){const c=X(Math.floor(o/500),Math.floor(r/500),n+8e3),h=[0,1,2,3,4,5];return h[c%h.length]}function rt(o,r,n,c){const h=X(r.chunkX,r.chunkY,n+5e3);if(v(h).next()>.15)return;let l=-1,i=0,t=0;for(let u=0;u<64;u++)for(let S=0;S<64;S++){const f=o[u][S];f.elevation>.3&&f.elevation>l&&(l=f.elevation,i=S,t=u)}if(l<.3)return;let s=i,e=t,a=0;const d=128;for(;a<d&&!(s<0||s>=64||e<0||e>=64);){const u=o[e][s];if(u.biome===1||u.biome===0||u.biome===2)break;u.riverStrength=Math.min(1,u.riverStrength+.3+a*.02),u.biome!==14&&u.riverStrength>.5&&(u.biome=14);let S=u.elevation,f=s,g=e;const m=[[s-1,e],[s+1,e],[s,e-1],[s,e+1],[s-1,e-1],[s+1,e-1],[s-1,e+1],[s+1,e+1]];for(const[y,x]of m)if(y>=0&&y<64&&x>=0&&x<64){const M=o[x][y];M.elevation<S&&(S=M.elevation,f=y,g=x)}if(f===s&&g===e)break;s=f,e=g,a++}}function j(o,r,n,c,h,p,l){const i=n-o,t=c-r;if(Math.sqrt(i*i+t*t)<.1)return null;const e=o-h,a=r-p,d=i*i+t*t,u=2*(e*i+a*t),S=e*e+a*a-l*l,f=u*u-4*d*S;if(f<0)return null;const g=Math.sqrt(f),m=(-u-g)/(2*d),y=(-u+g)/(2*d);if(y<0||m>1)return null;const x=Math.max(0,m),M=Math.min(1,y);return[{worldX:o+i*x,worldY:r+t*x},{worldX:o+i*M,worldY:r+t*M}]}function at(o,r,n,c){const h=[];if(c.next()<.4){const l=4+Math.floor(c.next()*4);for(let t=0;t<l;t++){const s=t/l*Math.PI*2+c.next()*.2;h.push({type:"main",points:[{worldX:o,worldY:r},{worldX:o+Math.cos(s)*n*.95,worldY:r+Math.sin(s)*n*.95}]})}const i=Math.floor(n/4);for(let t=1;t<=i;t++){const s=t/i*n*.8,e=16,a=[];for(let d=0;d<=e;d++){const u=d/e*Math.PI*2;a.push({worldX:o+Math.cos(u)*s,worldY:r+Math.sin(u)*s})}h.push({type:"secondary",points:a})}}else{const l=1.5+c.next()*1,i=c.next()*Math.PI/6,t=Math.cos(i),s=Math.sin(i);for(let e=-n;e<=n;e+=l){const a=o+e*t-n*s,d=r+e*s+n*t,u=o+e*t+n*s,S=r+e*s-n*t,f=j(a,d,u,S,o,r,n*.9);f&&h.push({type:Math.abs(e)<l?"main":"secondary",points:f})}for(let e=-n;e<=n;e+=l){const a=o+e*s+n*t,d=r-e*t+n*s,u=o+e*s-n*t,S=r-e*t-n*s,f=j(a,d,u,S,o,r,n*.9);f&&h.push({type:Math.abs(e)<l?"main":"secondary",points:f})}}return h}function ct(o,r,n,c,h,p){const l=h-n,i=p-c,t=l*l+i*i;if(t<1e-4)return Math.sqrt((o-n)**2+(r-c)**2);const s=Math.max(0,Math.min(1,((o-n)*l+(r-c)*i)/t)),e=n+s*l,a=c+s*i;return Math.sqrt((o-e)**2+(r-a)**2)}function lt(o,r,n,c,h){const p=[],l=.3+h.next()*.3,i=.4;for(let t=-n;t<n;t+=i)for(let s=-n;s<n;s+=i){if(Math.sqrt(s*s+t*t)>n*.85||h.next()>l)continue;const a=o+s+(h.next()-.5)*.2,d=r+t+(h.next()-.5)*.2;let u=!1;for(const g of c){for(let m=0;m<g.points.length-1;m++){const y=g.points[m],x=g.points[m+1];if(ct(a,d,y.worldX,y.worldY,x.worldX,x.worldY)<.3){u=!0;break}}if(u)break}if(u)continue;const S=.15+h.next()*.2,f=.15+h.next()*.2;p.push({id:`building_${a.toFixed(2)}_${d.toFixed(2)}`,footprint:[{worldX:a-S/2,worldY:d-f/2},{worldX:a+S/2,worldY:d-f/2},{worldX:a+S/2,worldY:d+f/2},{worldX:a-S/2,worldY:d+f/2}],height:1+h.next()*3})}return p}function ft(o,r,n,c,h,p){const l=[];if(c.next()>.08)return l;let i=0,t=64/2,s=64/2;for(let M=8;M<56;M+=8)for(let N=8;N<56;N+=8){const E=o[M][N];if(!ot(E.biome))continue;let C=1;C+=(1-Math.abs(E.elevation-.1))*2,C+=(1-Math.abs(E.moisture-.5))*1.5;for(let b=-5;b<=5;b++)for(let H=-5;H<=5;H++){const I=M+b,_=N+H;if(I>=0&&I<64&&_>=0&&_<64){const w=o[I][_];(w.biome===14||w.biome===2)&&(C+=.5)}}C>i&&(i=C,t=N,s=M)}if(i<2)return l;const e=r.chunkX*64+t,a=r.chunkY*64+s,d=O(e,a,n),u=p.generateCityName(d,e,a),S=Math.floor(500+c.next()*5e4),f=3+Math.sqrt(S/1e3),g=v(X(e,a,n+6e3)),m=at(e,a,f,g),y=lt(e,a,f,m,g),x={id:`city_${e}_${a}`,name:u,centerX:e,centerY:a,radius:f,population:S,regionStyle:d,streets:m,buildings:y};l.push(x);for(let M=-Math.ceil(f);M<=Math.ceil(f);M++)for(let N=-Math.ceil(f);N<=Math.ceil(f);N++)if(Math.sqrt(N*N+M*M)<=f){const C=s+M,b=t+N;C>=0&&C<64&&b>=0&&b<64&&(o[C][b].cityId=x.id)}return l}function F(o,r,n,c,h,p){var e;const l=c.chunkX*64,i=c.chunkY*64;let t=0;const s=15;for(let a=0;a<64;a++){let d=t,u=-999;for(let S=-s;S<=s;S++){let f,g,m,y;if(n==="vertical"?(f=r+S,g=a):(f=a,g=r+S),f<0||f>=64||g<0||g>=64)continue;m=l+f,y=i+g;const x=p.getElevation(m,y);if(x<-.05||x>.45)continue;const M=-Math.abs(S)*.1-Math.abs(x-.1);M>u&&(u=M,d=S)}if(u>-999){t=d;let S,f;n==="vertical"?(S=Math.max(0,Math.min(63,r+t)),f=a):(S=a,f=Math.max(0,Math.min(63,r+t)));const g=(e=o[f])==null?void 0:e[S];g&&g.roadType!==3&&(g.roadType=2)}}}function $(o,r,n,c,h,p,l,i){var f,g;const t=l.chunkX*64,s=l.chunkY*64,e=[],a=new Set,d={x:r,y:n,g:0,h:Math.abs(c-r)+Math.abs(h-n),f:Math.abs(c-r)+Math.abs(h-n),parent:null};e.push(d);const u=500;let S=0;for(;e.length>0&&S<u;){S++,e.sort((x,M)=>x.f-M.f);const m=e.shift();if(m.x===c&&m.y===h){let x=m;for(;x;){const M=(f=o[x.y])==null?void 0:f[x.x];M&&(M.roadType===0||i===3&&M.roadType!==3)&&(M.roadType=i),x=x.parent}return}a.add(`${m.x},${m.y}`);const y=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const{dx:x,dy:M}of y){const N=m.x+x,E=m.y+M;if(N<0||N>=64||E<0||E>=64||a.has(`${N},${E}`))continue;const C=(g=o[E])==null?void 0:g[N];if(!C)continue;const b=t+N,H=s+E,I=p.getElevation(b,H);if(C.biome===1||C.biome===0||C.biome===2||C.biome===13||I<-.05||I>.45)continue;let _=1;I>.35?_=8:I>.25?_=3:C.biome===14&&(_=4);const w=m.g+_,Z=Math.abs(c-N)+Math.abs(h-E),K=w+Z,k=e.find(U=>U.x===N&&U.y===E);k&&k.f<=K||(k?(k.g=w,k.h=Z,k.f=K,k.parent=m):e.push({x:N,y:E,g:w,h:Z,f:K,parent:m}))}}}function ut(o,r,n,c,h){const p=n.chunkX*64,l=n.chunkY*64,i=80,t=Math.round(p/i)*i,s=Math.round(l/i)*i;for(let e=-i;e<=i+64;e+=i){const a=t+e-p;a>=-5&&a<69&&F(o,Math.floor(a),"vertical",n,c,h);const d=s+e-l;d>=-5&&d<69&&F(o,Math.floor(d),"horizontal",n,c,h)}for(const e of r){const a=Math.floor(e.centerX-p),d=Math.floor(e.centerY-l),u=Math.round(e.centerX/i)*i-p,S=Math.round(e.centerY/i)*i-l;if(u>=0&&u<64&&$(o,a,d,Math.floor(u),d,h,n,2),S>=0&&S<64&&$(o,a,d,a,Math.floor(S),h,n,2),e.population>15e3){const f=Math.abs(u-a)<Math.abs(S-d)?{x:Math.floor(u),y:d}:{x:a,y:Math.floor(S)};f.x>=0&&f.x<64&&f.y>=0&&f.y<64&&$(o,a,d,f.x,f.y,h,n,3)}}}function ht(o){switch(o){case 5:case 6:return 10;case 9:case 10:return 5;case 7:return 11;default:return 3}}function dt(o,r,n,c,h){const p=[];for(const i of r)p.push({id:`label_${i.id}`,text:i.name,worldX:i.centerX,worldY:i.centerY+i.radius+2,type:i.population>1e4?0:1,minZoom:i.population>1e4?.5:2,maxZoom:100,fontSize:i.population>1e4?14:11});if(v(X(n.chunkX,n.chunkY,c+9e3)).next()<.1){const i=new Map;for(let e=0;e<64;e++)for(let a=0;a<64;a++){const d=o[e][a].biome;i.set(d,(i.get(d)||0)+1)}let t=4,s=0;for(const[e,a]of i)a>s&&e!==1&&e!==0&&(s=a,t=e);if(t===5||t===9||t===7||t===6||t===11){const e=n.chunkX*64+32,a=n.chunkY*64+64/2,d=O(e,a,c),u=h.generateRegionName(d,t,e,a);p.push({id:`region_${n.chunkX}_${n.chunkY}`,text:u,worldX:e,worldY:a,type:ht(t),minZoom:.3,maxZoom:5,fontSize:16})}}return p}function St(o,r,n,c){const h=X(o.chunkX,o.chunkY,r),p=v(h),l=[];for(let s=0;s<64;s++){l[s]=[];for(let e=0;e<64;e++){const a=o.chunkX*64+e,d=o.chunkY*64+s,u=n.getElevation(a,d),S=n.getMoisture(a,d),f=n.getTemperature(a,d),g=nt(u,S,f);l[s][e]={elevation:u,moisture:S,temperature:f,biome:g,riverStrength:0,roadType:0}}}rt(l,o,r);const i=ft(l,o,r,p,n,c);ut(l,i,o,r,n);const t=dt(l,i,o,r,c);return{coord:o,tiles:l,cities:i,roadSegments:[],labels:t,generatedAt:Date.now()}}let z=null,V=null,J=null;function Q(o){z!==o&&(z=o,V=et(o),J=it(o))}self.onmessage=o=>{const r=o.data;if(r.type==="init"){Q(r.seed),self.postMessage({type:"ready"});return}if(r.type==="generate"){Q(r.seed);const n=St({chunkX:r.chunkX,chunkY:r.chunkY},r.seed,V,J);self.postMessage({type:"chunk",chunkX:r.chunkX,chunkY:r.chunkY,chunk:n})}}})();
//# sourceMappingURL=ChunkWorker-DZ7vgkp1.js.map
