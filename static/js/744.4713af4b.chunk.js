(()=>{"use strict";const t=64;var e=function(t){return t[t.DEEP_OCEAN=0]="DEEP_OCEAN",t[t.OCEAN=1]="OCEAN",t[t.COASTAL_WATER=2]="COASTAL_WATER",t[t.BEACH=3]="BEACH",t[t.PLAINS=4]="PLAINS",t[t.FOREST=5]="FOREST",t[t.JUNGLE=6]="JUNGLE",t[t.DESERT=7]="DESERT",t[t.HILLS=8]="HILLS",t[t.MOUNTAINS=9]="MOUNTAINS",t[t.SNOW_PEAKS=10]="SNOW_PEAKS",t[t.TUNDRA=11]="TUNDRA",t[t.SWAMP=12]="SWAMP",t[t.LAKE=13]="LAKE",t[t.RIVER=14]="RIVER",t}(e||{}),o=function(t){return t[t.NONE=0]="NONE",t[t.DIRT=1]="DIRT",t[t.PAVED=2]="PAVED",t[t.RAIL=3]="RAIL",t}(o||{}),n=function(t){return t[t.CITY=0]="CITY",t[t.TOWN=1]="TOWN",t[t.VILLAGE=2]="VILLAGE",t[t.REGION=3]="REGION",t[t.MOUNTAIN=4]="MOUNTAIN",t[t.MOUNTAIN_RANGE=5]="MOUNTAIN_RANGE",t[t.LAKE=6]="LAKE",t[t.RIVER=7]="RIVER",t[t.SEA=8]="SEA",t[t.OCEAN=9]="OCEAN",t[t.FOREST=10]="FOREST",t[t.DESERT=11]="DESERT",t}(n||{}),r=function(t){return t[t.NORDIC=0]="NORDIC",t[t.CELTIC=1]="CELTIC",t[t.LATIN=2]="LATIN",t[t.DESERT=3]="DESERT",t[t.EASTERN=4]="EASTERN",t[t.FANTASY=5]="FANTASY",t}(r||{});function a(t){let e=t>>>0;function o(){e|=0,e=e+1831565813|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}return{next:o,nextInt:t=>Math.floor(o()*t),nextRange:(t,e)=>t+o()*(e-t),nextBool:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return o()<t},shuffle:t=>{const e=[...t];for(let n=e.length-1;n>0;n--){const t=Math.floor(o()*(n+1));[e[n],e[t]]=[e[t],e[n]]}return e},pick:t=>t[Math.floor(o()*t.length)]}}function i(t,e,o){let n=o;return n=Math.imul(n^t,2246822507),n=Math.imul(n^e,3266489909),n^=n>>>16,n>>>0}const s=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]],l=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6;function f(t){const e=a(t),o=[],n=[];for(let a=0;a<256;a++)o[a]=a;for(let a=255;a>0;a--){const t=e.nextInt(a+1);[o[a],o[t]]=[o[t],o[a]]}for(let a=0;a<512;a++)o[a]=o[255&a],n[a]=7&o[a];function r(t,e,o,n){return t*o+e*n}function i(t,e){const a=(t+e)*l,i=Math.floor(t+a),f=Math.floor(e+a),u=(i+f)*c,h=t-(i-u),E=e-(f-u);let d,A;h>E?(d=1,A=0):(d=0,A=1);const M=h-d+c,N=E-A+c,S=h-1+2*c,p=E-1+2*c,T=255&i,R=255&f;let m=0,x=0,I=0,O=.5-h*h-E*E;if(O>=0){O*=O;const t=n[T+o[R]],[e,a]=s[t];m=O*O*r(e,a,h,E)}let g=.5-M*M-N*N;if(g>=0){g*=g;const t=n[T+d+o[R+A]],[e,a]=s[t];x=g*g*r(e,a,M,N)}let k=.5-S*S-p*p;if(k>=0){k*=k;const t=n[T+1+o[R+1]],[e,a]=s[t];I=k*k*r(e,a,S,p)}return 70*(m+x+I)}return{noise2D:i,octaveNoise2D:function(t,e,o,n,r){let a=0,s=1,l=1,c=0;for(let f=0;f<o;f++)a+=i(t*l,e*l)*s,c+=s,s*=n,l*=r;return a/c},ridgedNoise2D:function(t,e,o,n,r){let a=0,s=1,l=1,c=0;for(let f=0;f<o;f++){const o=1-Math.abs(i(t*l,e*l));a+=o*o*s,c+=s,s*=n,l*=r}return a/c}}}const u=.002,h=.015,E=.08,d=.01,A=.005;function M(t){const e=f(t),o=f(t+1e3),n=f(t+2e3),r=f(t+3e3),a=f(t+4e3);return{getElevation:(t,r)=>{const a=e.octaveNoise2D(t*u,r*u,4,.5,2),i=o.ridgedNoise2D(t*h,r*h,4,.5,2),s=.15*n.octaveNoise2D(t*E,r*E,3,.5,2);return.4*a+.5*i*function(t,e,o){const n=Math.max(0,Math.min(1,(o-t)/(e-t)));return n*n*(3-2*n)}(-.1,.2,a)+s},getMoisture:(t,e)=>.5*r.octaveNoise2D(t*d,e*d,4,.5,2)+.5,getTemperature:(t,e)=>{const o=.4*Math.cos(.003*e)+.5,n=.2*a.octaveNoise2D(t*A,e*A,3,.5,2);return Math.max(0,Math.min(1,o+n))}}}function N(t,o,n){return t<-.3?e.DEEP_OCEAN:t<-.15?e.OCEAN:t<-.05?e.COASTAL_WATER:t<.02?e.BEACH:t>.55?e.SNOW_PEAKS:t>.4?e.MOUNTAINS:t>.25?e.HILLS:n<.25?e.TUNDRA:o<.25?e.DESERT:o<.4?n>.6?e.DESERT:e.PLAINS:o>.7?n>.65?e.JUNGLE:n<.35?e.SWAMP:e.FOREST:o>.5?n>.6?e.JUNGLE:e.FOREST:e.PLAINS}const S={[r.NORDIC]:{prefixes:["Thor","Frost","Iron","Storm","Wolf","Raven","Snow","Ice","Stone","Bear"],roots:["heim","gard","fjord","vik","dal","berg","holm","vang","fell","mark"],suffixes:["en","","stad","by","ness"]},[r.CELTIC]:{prefixes:["Dun","Glen","Bally","Kin","Strath","Aber","Kil","Loch","Ben","Cairn"],roots:["more","derry","bridge","ford","wick","ton","wood","field","vale","moor"],suffixes:["","ey","ie","ach","an"]},[r.LATIN]:{prefixes:["Port","Villa","Monte","Bella","Alta","Nova","Santa","San","Rio","Terra"],roots:["vista","mare","rosa","verde","luna","sol","oro","plata","cruz","piedra"],suffixes:["","ia","um","ino","ero"]},[r.DESERT]:{prefixes:["Al","El","Kas","Dar","Bab","Wadi","Oum","Ain","Jebel","Ras"],roots:["rashid","salem","qadir","malik","hamid","kareem","zahir","nadir","farid","jamil"],suffixes:["","a","i","abad","stan"]},[r.EASTERN]:{prefixes:["Jade","Golden","Silver","Dragon","Phoenix","Moon","Sun","Cloud","Misty","Crane"],roots:["peak","river","gate","bridge","garden","temple","spring","lake","forest","mountain"],suffixes:[""," Valley"," Heights"," Crossing",""]},[r.FANTASY]:{prefixes:["Shadow","Crystal","Silver","Ember","Thorn","Mist","Star","Dawn","Dusk","Rune"],roots:["mere","vale","spire","haven","hold","gate","wood","glade","keep","reach"],suffixes:["","shire","land","fell","dale"]}},p={[e.DEEP_OCEAN]:["Abyss","Depths","Deep"],[e.OCEAN]:["Sea","Waters","Ocean"],[e.COASTAL_WATER]:["Bay","Gulf","Strait"],[e.BEACH]:["Shore","Coast","Strand"],[e.PLAINS]:["Plains","Grasslands","Steppes","Prairie"],[e.FOREST]:["Forest","Woods","Woodland","Grove"],[e.JUNGLE]:["Jungle","Rainforest","Wilds"],[e.DESERT]:["Desert","Wastes","Sands","Dunes"],[e.HILLS]:["Hills","Highlands","Downs"],[e.MOUNTAINS]:["Mountains","Peaks","Range","Heights"],[e.SNOW_PEAKS]:["Frostpeaks","Snowcaps","Icepeaks"],[e.TUNDRA]:["Tundra","Wastes","Barrens","Expanse"],[e.SWAMP]:["Swamp","Marsh","Bog","Mire"],[e.LAKE]:["Lake","Loch","Mere"],[e.RIVER]:["River","Stream","Waters"]};function T(t,e,o){const n=i(Math.floor(t/500),Math.floor(e/500),o+8e3),a=[r.NORDIC,r.CELTIC,r.LATIN,r.DESERT,r.EASTERN,r.FANTASY];return a[n%a.length]}function R(t,e,o,n,r,a,i){const s=o-t,l=n-e;if(Math.sqrt(s*s+l*l)<.1)return null;const c=t-r,f=e-a,u=s*s+l*l,h=2*(c*s+f*l),E=h*h-4*u*(c*c+f*f-i*i);if(E<0)return null;const d=Math.sqrt(E),A=(-h-d)/(2*u),M=(-h+d)/(2*u);if(M<0||A>1)return null;const N=Math.max(0,A),S=Math.min(1,M);return[{worldX:t+s*N,worldY:e+l*N},{worldX:t+s*S,worldY:e+l*S}]}function m(t,e,o,n,r,a){const i=r-o,s=a-n,l=i*i+s*s;if(l<1e-4)return Math.sqrt((t-o)**2+(e-n)**2);const c=Math.max(0,Math.min(1,((t-o)*i+(e-n)*s)/l)),f=o+c*i,u=n+c*s;return Math.sqrt((t-f)**2+(e-u)**2)}function x(o,n,r,s,l,c){const f=[];if(s.next()>.08)return f;let u=0,h=t/2,E=t/2;for(let a=8;a<t-8;a+=8)for(let n=8;n<t-8;n+=8){const r=o[a][n];if((d=r.biome)!==e.PLAINS&&d!==e.FOREST&&d!==e.HILLS&&d!==e.BEACH)continue;let i=1;i+=2*(1-Math.abs(r.elevation-.1)),i+=1.5*(1-Math.abs(r.moisture-.5));for(let s=-5;s<=5;s++)for(let r=-5;r<=5;r++){const l=a+s,c=n+r;if(l>=0&&l<t&&c>=0&&c<t){const t=o[l][c];t.biome!==e.RIVER&&t.biome!==e.COASTAL_WATER||(i+=.5)}}i>u&&(u=i,h=n,E=a)}var d;if(u<2)return f;const A=n.chunkX*t+h,M=n.chunkY*t+E,N=T(A,M,r),S=c.generateCityName(N,A,M),p=Math.floor(500+5e4*s.next()),x=3+Math.sqrt(p/1e3),I=a(i(A,M,r+6e3)),O=function(t,e,o,n){const r=[];if(n.next()<.4){const a=4+Math.floor(4*n.next());for(let s=0;s<a;s++){const i=s/a*Math.PI*2+.2*n.next();r.push({type:"main",points:[{worldX:t,worldY:e},{worldX:t+Math.cos(i)*o*.95,worldY:e+Math.sin(i)*o*.95}]})}const i=Math.floor(o/4);for(let n=1;n<=i;n++){const a=n/i*o*.8,s=16,l=[];for(let o=0;o<=s;o++){const n=o/s*Math.PI*2;l.push({worldX:t+Math.cos(n)*a,worldY:e+Math.sin(n)*a})}r.push({type:"secondary",points:l})}}else{const a=1.5+1*n.next(),i=n.next()*Math.PI/6,s=Math.cos(i),l=Math.sin(i);for(let n=-o;n<=o;n+=a){const i=R(t+n*s-o*l,e+n*l+o*s,t+n*s+o*l,e+n*l-o*s,t,e,.9*o);i&&r.push({type:Math.abs(n)<a?"main":"secondary",points:i})}for(let n=-o;n<=o;n+=a){const i=R(t+n*l+o*s,e-n*s+o*l,t+n*l-o*s,e-n*s-o*l,t,e,.9*o);i&&r.push({type:Math.abs(n)<a?"main":"secondary",points:i})}}return r}(A,M,x,I),g=function(t,e,o,n,r){const a=[],i=.3+.3*r.next();for(let s=-o;s<o;s+=.4)for(let l=-o;l<o;l+=.4){if(Math.sqrt(l*l+s*s)>.85*o)continue;if(r.next()>i)continue;const c=t+l+.2*(r.next()-.5),f=e+s+.2*(r.next()-.5);let u=!1;for(const t of n){for(let e=0;e<t.points.length-1;e++){const o=t.points[e],n=t.points[e+1];if(m(c,f,o.worldX,o.worldY,n.worldX,n.worldY)<.3){u=!0;break}}if(u)break}if(u)continue;const h=.15+.2*r.next(),E=.15+.2*r.next();a.push({id:`building_${c.toFixed(2)}_${f.toFixed(2)}`,footprint:[{worldX:c-h/2,worldY:f-E/2},{worldX:c+h/2,worldY:f-E/2},{worldX:c+h/2,worldY:f+E/2},{worldX:c-h/2,worldY:f+E/2}],height:1+3*r.next()})}return a}(A,M,x,O,I),k={id:`city_${A}_${M}`,name:S,centerX:A,centerY:M,radius:x,population:p,regionStyle:N,streets:O,buildings:g};f.push(k);for(let e=-Math.ceil(x);e<=Math.ceil(x);e++)for(let n=-Math.ceil(x);n<=Math.ceil(x);n++){if(Math.sqrt(n*n+e*e)<=x){const r=E+e,a=h+n;r>=0&&r<t&&a>=0&&a<t&&(o[r][a].cityId=k.id)}}return f}function I(e,n,r,a,i,s){const l=a.chunkX*t,c=a.chunkY*t;let f=0;for(let h=0;h<t;h++){let a=f,i=-999;for(let e=-15;e<=15;e++){let o,f,u,E;if("vertical"===r?(o=n+e,f=h):(o=h,f=n+e),o<0||o>=t||f<0||f>=t)continue;u=l+o,E=c+f;const d=s.getElevation(u,E);if(d<-.05||d>.45)continue;const A=.1*-Math.abs(e)-Math.abs(d-.1);A>i&&(i=A,a=e)}if(i>-999){var u;let i,s;f=a,"vertical"===r?(i=Math.max(0,Math.min(t-1,n+f)),s=h):(i=h,s=Math.max(0,Math.min(t-1,n+f)));const l=null===(u=e[s])||void 0===u?void 0:u[i];l&&l.roadType!==o.RAIL&&(l.roadType=o.PAVED)}}}function O(n,r,a,i,s,l,c,f){const u=c.chunkX*t,h=c.chunkY*t,E=[],d=new Set,A={x:r,y:a,g:0,h:Math.abs(i-r)+Math.abs(s-a),f:Math.abs(i-r)+Math.abs(s-a),parent:null};E.push(A);let M=0;for(;E.length>0&&M<500;){M++,E.sort(((t,e)=>t.f-e.f));const r=E.shift();if(r.x===i&&r.y===s){let t=r;for(;t;){var N;const e=null===(N=n[t.y])||void 0===N?void 0:N[t.x];e&&(e.roadType===o.NONE||f===o.RAIL&&e.roadType!==o.RAIL)&&(e.roadType=f),t=t.parent}return}d.add(`${r.x},${r.y}`);const a=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}];for(const{dx:o,dy:c}of a){var S;const a=r.x+o,f=r.y+c;if(a<0||a>=t||f<0||f>=t)continue;if(d.has(`${a},${f}`))continue;const A=null===(S=n[f])||void 0===S?void 0:S[a];if(!A)continue;const M=u+a,N=h+f,p=l.getElevation(M,N);if(A.biome===e.OCEAN||A.biome===e.DEEP_OCEAN||A.biome===e.COASTAL_WATER||A.biome===e.LAKE||p<-.05||p>.45)continue;let T=1;p>.35?T=8:p>.25?T=3:A.biome===e.RIVER&&(T=4);const R=r.g+T,m=Math.abs(i-a)+Math.abs(s-f),x=R+m,I=E.find((t=>t.x===a&&t.y===f));I&&I.f<=x||(I?(I.g=R,I.h=m,I.f=x,I.parent=r):E.push({x:a,y:f,g:R,h:m,f:x,parent:r}))}}}function g(t){switch(t){case e.FOREST:case e.JUNGLE:return n.FOREST;case e.MOUNTAINS:case e.SNOW_PEAKS:return n.MOUNTAIN_RANGE;case e.DESERT:return n.DESERT;default:return n.REGION}}function k(r,s,l,c){const f=a(i(r.chunkX,r.chunkY,s)),u=[];for(let e=0;e<t;e++){u[e]=[];for(let n=0;n<t;n++){const a=r.chunkX*t+n,i=r.chunkY*t+e,s=l.getElevation(a,i),c=l.getMoisture(a,i),f=l.getTemperature(a,i),h=N(s,c,f);u[e][n]={elevation:s,moisture:c,temperature:f,biome:h,riverStrength:0,roadType:o.NONE}}}!function(o,n,r,s){if(a(i(n.chunkX,n.chunkY,r+5e3)).next()>.15)return;let l=-1,c=0,f=0;for(let e=0;e<t;e++)for(let n=0;n<t;n++){const t=o[e][n];t.elevation>.3&&t.elevation>l&&(l=t.elevation,c=n,f=e)}if(l<.3)return;let u=c,h=f,E=0;const d=2*t;for(;E<d&&!(u<0||u>=t||h<0||h>=t);){const n=o[h][u];if(n.biome===e.OCEAN||n.biome===e.DEEP_OCEAN||n.biome===e.COASTAL_WATER)break;n.riverStrength=Math.min(1,n.riverStrength+.3+.02*E),n.biome!==e.RIVER&&n.riverStrength>.5&&(n.biome=e.RIVER);let r=n.elevation,a=u,i=h;const s=[[u-1,h],[u+1,h],[u,h-1],[u,h+1],[u-1,h-1],[u+1,h-1],[u-1,h+1],[u+1,h+1]];for(const[e,l]of s)if(e>=0&&e<t&&l>=0&&l<t){const t=o[l][e];t.elevation<r&&(r=t.elevation,a=e,i=l)}if(a===u&&i===h)break;u=a,h=i,E++}}(u,r,s);const h=x(u,r,s,f,0,c);!function(e,n,r,a,i){const s=r.chunkX*t,l=r.chunkY*t,c=80,f=Math.round(s/c)*c,u=Math.round(l/c)*c;for(let o=-80;o<=c+t;o+=c){const n=f+o-s;n>=-5&&n<t+5&&I(e,Math.floor(n),"vertical",r,0,i);const a=u+o-l;a>=-5&&a<t+5&&I(e,Math.floor(a),"horizontal",r,0,i)}for(const h of n){const n=Math.floor(h.centerX-s),a=Math.floor(h.centerY-l),f=Math.round(h.centerX/c)*c-s,u=Math.round(h.centerY/c)*c-l;if(f>=0&&f<t&&O(e,n,a,Math.floor(f),a,i,r,o.PAVED),u>=0&&u<t&&O(e,n,a,n,Math.floor(u),i,r,o.PAVED),h.population>15e3){const s=Math.abs(f-n)<Math.abs(u-a)?{x:Math.floor(f),y:a}:{x:n,y:Math.floor(u)};s.x>=0&&s.x<t&&s.y>=0&&s.y<t&&O(e,n,a,s.x,s.y,i,r,o.RAIL)}}}(u,h,r,0,l);const E=function(o,r,s,l,c){const f=[];for(const t of r)f.push({id:`label_${t.id}`,text:t.name,worldX:t.centerX,worldY:t.centerY+t.radius+2,type:t.population>1e4?n.CITY:n.TOWN,minZoom:t.population>1e4?.5:2,maxZoom:100,fontSize:t.population>1e4?14:11});if(a(i(s.chunkX,s.chunkY,l+9e3)).next()<.1){const n=new Map;for(let e=0;e<t;e++)for(let r=0;r<t;r++){const t=o[e][r].biome;n.set(t,(n.get(t)||0)+1)}let r=e.PLAINS,a=0;for(const[t,o]of n)o>a&&t!==e.OCEAN&&t!==e.DEEP_OCEAN&&(a=o,r=t);if(r===e.FOREST||r===e.MOUNTAINS||r===e.DESERT||r===e.JUNGLE||r===e.TUNDRA){const e=s.chunkX*t+t/2,o=s.chunkY*t+t/2,n=T(e,o,l),a=c.generateRegionName(n,r,e,o);f.push({id:`region_${s.chunkX}_${s.chunkY}`,text:a,worldX:e,worldY:o,type:g(r),minZoom:.3,maxZoom:5,fontSize:16})}}return f}(u,h,r,s,c);return{coord:r,tiles:u,cities:h,roadSegments:[],labels:E,generatedAt:Date.now()}}let L=null,D=null,C=null;function v(t){L!==t&&(L=t,D=M(t),C=function(t){return{generateCityName:(e,o,n)=>{const r=a(i(Math.floor(o),Math.floor(n),t+7919)),s=S[e],l=r.next()<.7,c=r.next()<.5;let f="";return l&&(f+=r.pick(s.prefixes)),f+=r.pick(s.roots),c&&(f+=r.pick(s.suffixes)),f.charAt(0).toUpperCase()+f.slice(1)},generateRegionName:(e,o,n,r)=>{const s=a(i(Math.floor(n),Math.floor(r),t+8923)),l=S[e],c=p[o]||["Lands"],f=[()=>`The ${s.pick(l.prefixes)} ${s.pick(c)}`,()=>`${s.pick(l.prefixes)}${s.pick(l.roots)} ${s.pick(c)}`,()=>`${s.pick(c)} of ${s.pick(l.prefixes)}${s.pick(l.roots)}`];return s.pick(f)()}}}(t))}self.onmessage=t=>{const e=t.data;if("init"===e.type)return v(e.seed),void self.postMessage({type:"ready"});if("generate"===e.type){v(e.seed);const t=k({chunkX:e.chunkX,chunkY:e.chunkY},e.seed,D,C);self.postMessage({type:"chunk",chunkX:e.chunkX,chunkY:e.chunkY,chunk:t})}}})();
//# sourceMappingURL=744.4713af4b.chunk.js.map